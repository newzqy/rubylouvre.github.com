<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
        <title>collection.find</title>
        <script type="text/javascript" src="/scripts/mass_merge.js"></script>
        <script type="text/javascript" src="/scripts/doc/shCore.js"></script>
        <script type="text/javascript" src="/scripts/doc/common.js"></script>
        <script type="text/javascript" src="/scripts/doc/shBrushJScript.js"></script>
        <script type="text/javascript" src="/scripts/doc/shBrushCss.js"></script>
        <script type="text/javascript" src="/scripts/doc/shBrushXml.js"></script>
        <link media="screen" rel="stylesheet" type="text/css" href="/styles/doc/common.css" />
        <link media="screen" rel="stylesheet" type="text/css" href="/styles/doc/shCore.css" />
        <link media="screen" rel="stylesheet" type="text/css" href="/styles/doc/shThemeRDark.css" />

        
        

    </head>
    <body>
        <article>
           

<h3>查询相关</h3>
<p>find方法会根据最后一个参数是否为回调函数决定是同步方法或还异步方法，如果是异步方法，那么回调的第二个参数则是cursor对象。
    同步方法不用说也是cursor对象
</p>
<br/>
<p>find方法支持传入多个对象作为过滤条件得到我们想要的结果，如果想得到所有数据，可以什么都不传或只传个空对象</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
 var cursor = db.users.find({})
 var cursor = db.users.find()
</pre>
<p>它的所有传参形式</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
 *  - callback?
 *  - selector, callback?,
 *  - selector, fields, callback?
 *  - selector, options, callback?
 *  - selector, fields, options, callback?
 *  - selector, fields, skip, limit, callback?
 *  - selector, fields, skip, limit, timeout, callback?
</pre>
<br/>
<p>我们可以根据对象某个属性进行过滤.</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
 var cursor = db.users.find({'last_name': 'Smith'})
</pre>
<p>并且这个查询对象将作为返回cursor的selector属性。</p>
<p>返回只包含一条记录的cursor.</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
 var cursor = db.users.findOne()
</pre>
<br/>
<p>limit:对返回记录数进行限制</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
 var cursor = db.users.find({'msg':'Hello 1'}).limit(10)
//或者
var cursor = db.users.find({'msg':'Hello 1'},{"limit":10})
</pre>
<br/>
<p>skip:跳跃到已得到的结果某一条中,配合上面limit可以轻易实现分页功能.</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
page1 = db.things.find().limit(20)
page2 = db.things.find().skip(20).limit(20)
page3 = db.things.find().skip(40).limit(20)
//更简单的写法
page3 = db.things.find({}, {}, 20, 40);
</pre>
<p>注:当数据量很大时，skip操作会变的很慢，应该避免使用。（不止是mongoDb会这样，大部分数据库都是。）
    可以通过改变查询文档的规则来达到分页效果，避免使用skip来跳过大量的数据。通过计算，得到下次查询应该从什么地方开始
</p>
<br/>
<p>sort排序</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
 var cursor = db.users.find({'email':'ixigua@sina.com'}).sort({'Dt',-1})
//或者
var cursor =  db.users.find({'email':'ixigua@sina.com'},{"sort":{'Dt',-1}} )
//上面的-1表示倒序
var cursor =  db.users.find({'email':'ixigua@sina.com'},{"sort":"Dt"} )
</pre>
<br/>
<p>count操作，返回匹配的记录数</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
 db.user_addr.count()
</pre>
<p>distinct操作，对记录进行去重</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
 db.users.distinct('msg')
</pre>
<br/>
<p>对数值类型的属性可以通过比较大小的操作进行过滤</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
db.collection.find({ "field" : { $gt: value } } );   // greater than  : field > value
db.collection.find({ "field" : { $lt: value } } );   // less than  :  field < value
db.collection.find({ "field" : { $gte: value } } );  // greater than or equal to : field >= value
db.collection.find({ "field" : { $lte: value } } );  // less than or equal to : field <=
</pre>
<p>还可以复合使用</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
db.collection.find({ "field" : { $gt: value1, $lt: value2 } } );
</pre>
<br/>
<p>$exists操作：判断字段是否存在 </p>
<p>查询所有存在name字段的记录 </p>
<pre class="brush:javascript;gutter:false;toolbar:false">
db.users.find({name: {$exists: true}});
</pre>
<p>查询所有不存在phone字段的记录 </p>
<pre class="brush:javascript;gutter:false;toolbar:false">
db.users.find({phone: {$exists: false}});
</pre> 
<br/>
<p>$all,匹配所有 </p>
<pre class="brush:javascript;gutter:false;toolbar:false">
db.users.find({favorite_number : {$all : [6, 8]}});
</pre>
<p>查询出{name: 'David', age: 26, favorite_number: [ 6, 8, 9 ] } </p>
<p>过滤掉{name: 'David', age: 26, favorite_number: [ 6, 7, 9 ] } </p>
<br/>
<p>$not,不匹配</p>
<p>查询不匹配name=B*带头的记录 </p>
<pre class="brush:javascript;gutter:false;toolbar:false">
db.users.find({name: {$not: /^B.*/}});
</pre>
<p>查询 age取模10不等于0 的数据 </p>
<pre class="brush:javascript;gutter:false;toolbar:false">
db.users.find({age : {$not: {$mod : [10, 0]}}});
</pre>
<p>$where查询 </p>
<pre class="brush:javascript;gutter:false;toolbar:false">
//查询 age > 18 的记录，以下查询都一样
db.users.find({age: {$gt: 18}});
db.users.find({$where: "this.age > 18"});
db.users.find("this.age > 18");
var f = function() {return this.age > 18} db.users.find(f);
</pre>
<p>根据子对象的属性查询</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
db.users.find({age : {$not: {$mod : [10, 0]}}});
</pre>
<p>$type判断字段类型 </p>
<pre class="brush:javascript;gutter:false;toolbar:false">
//查询所有name字段是字符类型的
db.users.find({name: {$type: 2}});
//查询所有age字段是整型的
db.users.find({age: {$type: 16}});
</pre>
<table class="table1" border="1" >
    <tbody>
        <tr>
            <td>
                Type Name
            </td>
            <td>
                Type Number
            </td>
        </tr>
        <tr>
            <td>
                Double
            </td>
            <td>
                1
            </td>
        </tr>
        <tr>
            <td>
                String
            </td>
            <td>
                2
            </td>
        </tr>
        <tr>
            <td>
                Object
            </td>
            <td>
                3
            </td>
        </tr>
        <tr>
            <td>
                Array
            </td>
            <td>
                4
            </td>
        </tr>
        <tr>
            <td>
                Binary data
            </td>
            <td>
                5
            </td>
        </tr>
        <tr>
            <td>
                Object id
            </td>
            <td>
                7
            </td>
        </tr>
        <tr>
            <td>
                Boolean
            </td>
            <td>
                8
            </td>
        </tr>
        <tr>
            <td>
                Date
            </td>
            <td>
                9
            </td>
        </tr>
        <tr>
            <td>
                Null
            </td>
            <td>
                10
            </td>
        </tr>
        <tr>
            <td>
                Regular expression
            </td>
            <td>
                11
            </td>
        </tr>
        <tr>
            <td>
                JavaScript code
            </td>
            <td>
                13
            </td>
        </tr>
        <tr>
            <td>
                Symbol
            </td>
            <td>
                14
            </td>
        </tr>
        <tr>
            <td>
                JavaScript code with scope
            </td>
            <td>
                15
            </td>
        </tr>
        <tr>
            <td>
                32-bit integer
            </td>
            <td>
                16
            </td>
        </tr>
        <tr>
            <td>
                Timestamp
            </td>
            <td>
                17
            </td>
        </tr>
        <tr>
            <td>
                64-bit integer
            </td>
            <td>
                18
            </td>
        </tr>
        <tr>
            <td>
                Min key
            </td>
            <td>
                255
            </td>
        </tr>
        <tr>
            <td>
                Max key
            </td>
            <td>
                127
            </td>
        </tr>
    </tbody>
</table>
<br/>
<p>each方法</p>
<p>不过坑爹的方法,如果cursor里面包含三个记录,那么它会遍历四次,最后一次为null.</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
var cursor = db.users.find()
cursor.each(function(err, item) {
    if(item != null) {
        console.log(item)
    };
});
</pre>
<p>toArray方法,带一个不能省略的回调作参数,内部调用上面的each方法，将cursor包含的所有记集变成一个数组放到此回调中</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
var cursor = db.users.find()
cursor.toArray(function(e,array){
    console.log(array)
 })
</pre>
<p>raw ：让包含的记录变成Buffer</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
        person.insert({
            name:"aaa"
        })
        person.insert({
            name:"bbb"
        })
        person.insert({
            name:"ccc"
        });
        person.find({},{raw:true}).toArray(function(e,array){
            console.log(array)
        })
</pre>
<p>结果显示如下：</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
[ <Buffer 24 00 00 00 02 6e 61 6d 65 00 04 00 00 00 61 61 61 00 07 5f 69 64 00 5
0 28 fb f4 5e ec 07 f4 18 00 00 01 00>,
  <Buffer 24 00 00 00 02 6e 61 6d 65 00 04 00 00 00 63 63 63 00 07 5f 69 64 00 5
0 28 fb f4 5e ec 07 f4 18 00 00 03 00>,
  <Buffer 24 00 00 00 02 6e 61 6d 65 00 04 00 00 00 62 62 62 00 07 5f 69 64 00 5
0 28 fb f4 5e ec 07 f4 18 00 00 02 00>,
  <Buffer 24 00 00 00 02 6e 61 6d 65 00 04 00 00 00 62 62 62 00 07 5f 69 64 00 5
0 28 fd ab 58 ac 1e 40 1c 00 00 02 00>,
  <Buffer 24 00 00 00 02 6e 61 6d 65 00 04 00 00 00 63 63 63 00 07 5f 69 64 00 5
0 28 fd ab 58 ac 1e 40 1c 00 00 03 00>,
  <Buffer 24 00 00 00 02 6e 61 6d 65 00 04 00 00 00 61 61 61 00 07 5f 69 64 00 5
0 28 fd ab 58 ac 1e 40 1c 00 00 01 00>,
  <Buffer 24 00 00 00 02 6e 61 6d 65 00 04 00 00 00 61 61 61 00 07 5f 69 64 00 5
0 28 fe 23 f0 2a 89 e0 1f 00 00 01 00>,
  <Buffer 24 00 00 00 02 6e 61 6d 65 00 04 00 00 00 62 62 62 00 07 5f 69 64 00 5
0 28 fe 23 f0 2a 89 e0 1f 00 00 02 00>,
  <Buffer 24 00 00 00 02 6e 61 6d 65 00 04 00 00 00 63 63 63 00 07 5f 69 64 00 5
0 28 fe 23 f0 2a 89 e0 1f 00 00 03 00> ]
                                        </pre>
                                        <p>nextObject:cursor的原型方法，一个比each, toArray更好用的得到记录的方法</p>
                                        <pre class="brush:javascript;gutter:false;toolbar:false">
        cursor.nextObject(function(){
            console.log( cursor.items)
        })
                                        </pre>
        </article>
   </body>
</html>